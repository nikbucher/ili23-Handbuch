[#_6_12]
=== How do clocks tick in Ilis Valley? – Modeling time

[#_6_12_1]
==== Sufficient for modest pretensions

The National Tourist Office provides a simple solution in the form of an attribute for the validity of ticket types, which shows the number of days (with one decimal).

[source]
----
Validity: 0.0 .. 1000.0 [d];
----

If – like people in Ilis Valley – one is more concerned with details, several questions arise:

* A ticket valid on the day of issue has not the same validity as one that is valid for 24 hours.
* A month may have 28, 30, or 31 days.
* A year may either have 365 or 366 days.

Upon their inquiry, the National Tourist Office offered the answer that the following rules applied to questions of validity:

* 0.9: on the day of issue;
* 30.0: one month;
* 365.0: one year.

[WARNING]
Such makeshift solution may at times seem appealing, because they appear to be simple. But what if 30.0 days really means that exact number of days and not one month? It pays to proceed with precaution!

But what then would be a better solution?

[#_6_12_2]
==== Length of time as structure

It is not always possible to describe with sufficient precision object characteristics such as validity by one single value. Sometimes a whole group of attributes is necessary, sometimes it makes sense to plan several extensions. That is where structures provide a convenient solution.

[source]
----
STRUCTURE LengthOfTime (ABSTRACT) =
END LengthOfTime;

STRUCTURE LengthOfTimeToday EXTENDS LengthOfTime =
END LengthOfTimeToday;

STRUCTURE LengthOfTimeInDays EXTENDS LengthOfTime =
  Duration: MANDATORY Days [d];
END LengthOfTimeInDays;

....

CLASS TicketType =
  Validity: LengthOfTime;
END TicketType;
----

The validity of one particular ticket type is described by means of an instance (a structure element) of the structure LengthOfTimeToday, LengthOfTimeInDays, LengthOfTimeInMonths etc. We could even go further in our modeling and make sure that the units of an explicit duration (day, month etc.) always have to be a length of time and define an enumeration for implicit duration (week, season etc.):

[source]
----
STRUCTURE LengthOfTime (ABSTRACT) =
END LengthOfTime;

STRUCTURE LengthOfTimeImplicit EXTENDS LengthOfTime =
  Duration: MANDATORY (Day, Week, Month, Year);
END LengthOfTimeImplicit;

STRUCTURE LengthOfTimeExplicit (ABSTRACT) EXTENDS LengthOfTime =
  Duration (ABSTRACT): MANDATORY NUMERIC [TIME];
END LengthOfTimeExplicit;

STRUCTURE LengthOfTimeInMinutes EXTENDS LengthOfTimeExplicit =
  Duration (EXTENDED): MANDATORY 0 .. 200 [Units.min];
END LengthOfTimeInMinutes;

STRUCTURE LengthOfTimeInDays EXTENDS LengthOfTimeExplicit =
  Duration (EXTENDED): MANDATORY 0 .. 1000 [d];
END inDays;
----

.Length of time in detailed modeling with structures. Thus it is possible that if required the validity of a ticket can be either one month (LengthOfTimeImplicit; left) or exactly thirty days (LengthOfTimeInDays; right).
image::img/image52.png[]


[WARNING]
Basically we aim at a precise, detailed and appropriate modeling. However one should always keep in mind that this only makes sense if it can also be translated into action. What does this mean for program packages? And moreover: What does it mean for the people that gather and deal with data? And vice versa: What does it mean if we differ from the most correct of all possible models? All things considered it may pay to be satisfied with a more simple solution.

[#_6_12_3]
==== Exact length of time

Length of time does not only exist for tickets. Every Friday Ilis Valley organizes a ski race for their guests. Racing times are measured in minutes, seconds and their fractions. For this we could define a structure, which features the attributes hours, minutes and seconds: It seems natural to define a structure featuring the attributes minutes and seconds:

[source]
----
STRUCTURE LengthOfTimeInMinutes EXTENDS LengthOfTime =
  Minutes: 0 .. 9999.99 [min];
  Seconds: 0.00 .. 59.99 [s];
END LengthOfTimeInMinutes;
----

To express the relationship between minutes and seconds, the following additional solution presents itself:

[source]
----
STRUCTURE LengthOfTimeInMinutes EXTENDS LengthOfTime =
  Minutes: 0 .. 9999.99 [min];
  CONTINOUS SUBDIVISION Seconds: 0.00 .. 59.99 [s];
END LengthOfTimeInMinutes;
----

This does not determine in what form such a length of time would be memorized in a computer. It simply is a means of describing as precisely as possible what we really want.

[#_6_12_4]
==== Formatted representation of structures

The traditional ski race for guests is always designed in a way that even skiing instructors will take more than 30 seconds to do the course. Participants that take more than 3 minutes and 30 seconds are offered a cup of tea at the finish, but their result will not be registered.

How do we record the admissible domain (from 30 seconds to 3 minutes and 30 seconds)? The solution is provided by formatted domains:

[source]
----
DOMAIN LengthOfTimeinMinSec = FORMAT BASED ON LengthOfTimeInMinutes
                               ( Minutes ":" Seconds );

CLASS RaceTime =
  FirstName: TEXT*50;
  Surname: TEXT*50;
  Runtime: FORMAT LengthOfTimeinMinSec "0:30" .. "3:30";
END RaceTime;
----

A formatted domain refers to a structure and determines the design of a string of symbols composed of the individual attributes of the structure and text constants representing the value. In this form it is possible to define restrictions for the domain. This formatted representation will also be used for data transfer. Thus it may be possible to directly support certain representation forms demanded by external authorities. This is of special interest fort the XML-conform representation of duration and points in time.

[#_6_12_5]
==== Moments in time

Reports regarding weather conditions, waiting times, conditions of the ski runs in Ilis Valley shall always state the time at which these conditions were observed. First thought: Time in hours and minutes. Yes, and in order to establish statistics, the respective date. That should be enough!

Really? On good nights with a full moon the Mount Ilis Alpine Transports do extra runs up to Mount Ilis, where then the popular Dracula-Party takes place. So even in the middle of the night reports on conditions are issued. Even at 2.30 am. Also on that early Sunday morning when the hands of the clock were switched over to daylight saving. However that was quite chaotic. Suddenly the latest report dated further back than the last! Naturally enough: That night any time between 2 am and 3 am appeared twice.

[NOTE]
With moments in time it is always important to know the respective reference system.

Are we speaking of summertime, wintertime, UTC? The more international we get, the more important it is to know. It is a short step to the idea to report everything in UTC and to leave it up to the computer to present the data to the user according to his current time zone.

INTERLIS 2 not only offers the possibility to describe domains and units, but also reference systems. For UTC-times already formatted domains in accordance with XML-rules have been predefined (XMLTime, XMLDate, XMLDateTime).

Then again opening and operating hours preferably are described in local time. After all midnight is at 24.00, whether it is summertime or wintertime. These are not moments in time in the true sense of the word; they actually describe differences to the midnight hour according to the currently valid time.

[WARNING]
Wherever time, and above all precise moments in time are of importance, we have to proceed with outmost care.

[#_6_13]
